== 必要環境 ==

=== システム構成

Kubernetes をインストールする際のシステム構成としては以下の３通りがあります。
構成に応じて必要なマシン数が変わってきます。

. スタンドアロン: 1台のみの構成
** 1台のマシンのみを使用し、Kubernetes マスター・ワーカーを同居させる構成です。
** ワークロードも同一マシン上で動作することになります。
** 開発環境や検証・デモ用途でのみの利用を推奨します
. シングルマスター: マスター1台、ワーカー1台以上の構成
** マスター1台に、複数台のワーカーで構成します。
** ワークロードはワーカー上で動作します。
** マスターノードが SPOF になりますので、本番環境での利用は推奨しません。
. HA構成: マスター3台、ワーカー1台以上の構成
** マスター3台でHA構成を組む構成です。
** マスター上で稼働する kube-apiserver に対して負荷分散をする必要があるため、別途 L4 ロードバランサが必要です。

HA構成を組む場合は、マスターノードとして最低3台のマシンが必要です。
またこれに加えてワーカーノードが最低1台、推奨3台以上が必要です。
ワーカーノードの台数は、実行するワークロードの量によって変わります。

=== 必要マシン

Kubernetes を構成する各マシンについて説明します。

==== OS

以下いずれかの OS がインストールされたマシンが必要です。

* RedHat Enterprise Linux (RHEL) 7 (7.7以上), 8
** subscription-manager で RedHat サブスクリプションの register を完了させている必要があります。
* CentOS 7 (7.7以上), 8
* Ubuntu 18.04, 20.04

NOTE: RHEL8 / CentOS8 / Ubuntu は Ansible インストーラのみ対応しています。

WARNING: RHEL8 / CentOS8 を使用する場合、firewalld を併用することはできません。

==== スペック

マシンのスペックとしては以下のものが必要です。

* 1台あたり2GB以上のメモリ
** ただし、2GBの場合アプリ用のスペースはほとんどありません。推奨は16GB以上です。
* 2コア以上のCPU

==== ネットワーク

ネットワークについては以下の要件が必要です。

* クラスター内のすべてのマシン間で通信可能なネットワーク
** パブリックネットワークでもプライベートネットワークでも構いません
* インターネット接続
** Proxyサーバを経由した接続でも構いません。
** オフラインインストール時はインターネット接続は不要です。ただし、その場合でもデフォルトルートは設定されている必要があります。

==== その他の要件

* ユニークなhostname、MACアドレス、product_uuidが各ノードに必要
** hostname は `hostname` コマンドで確認してください。
** MAC アドレスは `ip link` または `ifconfig -a` で確認してください。
** product_uuid は `sudo cat /sys/class/dmi/id/product_uuid` で確認してください。
** 詳細は https://kubernetes.io/ja/docs/setup/production-environment/tools/kubeadm/install-kubeadm/[kubeadmのインストール]
の「MACアドレスとproduct_uuidが全てのノードでユニークであることの検証」を参照してください。
* マシン内の特定のポートがファイヤウォールで開放されていること。
** 開放するポートの詳細は https://kubernetes.io/ja/docs/setup/production-environment/tools/kubeadm/install-kubeadm/[必須ポートの確認] を参照してください。
** インストーラを使用する場合は、自動的にファイヤウォールの設定が行われます。
* Swapがオフであること。
** kubeletが正常に動作するためにはswapは必ずオフでなければなりません。
** インストーラを使用する場合は、自動的に Swap をオフにします。

=== ロードバランサ

HA構成を組む場合は、L4(TCP)レベルのロードバランサが必要です。

* ロードバランサには DNS 解決可能な FQDN 名が設定されていること
* L4 レベルの負荷分散を行うこと
** TCP 6443 番ポートをマスターノード(3台)の TCP 6443番ポートに負荷分散すること
** TCPコネクションでのヘルスチェックを行うこと

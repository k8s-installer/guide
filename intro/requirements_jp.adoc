== 必要環境 ==

=== システム構成

Kubernetes をインストールする際のシステム構成としては以下の３通りがあります。
構成に応じて必要なマシン数が変わってきます。

. スタンドアロン: 1台のみの構成
** 1台のマシンのみを使用し、Kubernetes マスター・ワーカーを同居させる構成です。
** ワークロードも同一マシン上で動作することになります。
** 開発環境や検証・デモ用途でのみの利用を推奨します
. シングルマスター: マスター1台、ワーカー1台以上の構成
** マスター1台に、複数台のワーカーで構成します。
** ワークロードはワーカー上で動作します。
** マスターノードが SPOF になりますので、本番環境での利用は推奨しません。
. HA構成: マスター3台、ワーカー1台以上の構成
** マスター3台でHA構成を組む構成です。
** マスター上で稼働する kube-apiserver に対して負荷分散をする必要があるため、別途 L4 ロードバランサが必要です。

HA構成を組む場合は、マスターノードとして最低3台のマシンが必要です。
またこれに加えてワーカーノードが最低1台、推奨3台以上が必要です。
ワーカーノードの台数は、実行するワークロードの量によって変わります。

=== 必要マシン

Kubernetes を構成する各マシンについて説明します。

==== OS

以下いずれかの OS がインストールされたマシンが必要です。

* RedHat Enterprise Linux (RHEL) 7 (7.7以上)
** subscription-manager で RedHat サブスクリプションの register を完了させている必要があります。
* CentOS 7 (7.7以上)

==== スペック

マシンのスペックとしては以下のものが必要です。

* 1台あたり2GB以上のメモリ
** ただし、2GBの場合アプリ用のスペースはほとんどありません。推奨は16GB以上です。
* 2コア以上のCPU

==== ネットワーク

ネットワークについては以下の要件が必要です。

* クラスター内のすべてのマシン間で通信可能なネットワーク
** パブリックネットワークでもプライベートネットワークでも構いません
* インターネット接続 (オンラインインストール時のみ)

==== その他の要件

* ユニークなhostname、MACアドレス、とproduct_uuidが各ノードに必要
* マシン内の特定のポートがファイヤウォールで開放されていること。詳細は後述します。
* Swapがオフであること。kubeletが正常に動作するためにはswapは必ずオフでなければなりません。

=== ロードバランサ

HA構成を組む場合は、L4(TCP)レベルのロードバランサが必要です。

* ロードバランサには DNS 解決可能な FQDN 名が設定されていること
* L4 レベルの負荷分散を行うこと
** TCP 6443 番ポートをマスターノード(3台)の TCP 6443番ポートに負荷分散すること
** TCPコネクションでのヘルスチェックを行うこと
